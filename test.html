<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Demo Aplikasi Web Modern — All-in-One</title>
  <!-- manifest sebagai data URL agar tetap single-file -->
  <link rel="manifest" href='data:application/json,{"name":"Demo WebFitur","short_name":"WebFitur","start_url":"./","display":"standalone","icons":[{"src":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABq0lEQVR4nO2ZsU3DMBREv0tCq0gq0gq0gq0gq0gq0gq0gq0gq0gq0gq0gq0gq0gq0gq0gq0gq0gq0gq0gq0gq0gq0gq0gq0gq0oL8q+H3Yf5f4bq7s4FvA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA1gA/4A0wBz3GJqZCwAAAABJRU5ErkJggg==","sizes":"64x64","type":"image/png"}]}'/>
  <style>
    :root{font-family:system-ui,Segoe UI,Roboto,"Noto Sans",Arial;margin:0;color:#0f172a}
    body{padding:18px;max-width:980px;margin:auto}
    header{display:flex;gap:12px;align-items:center}
    h1{font-size:18px;margin:0}
    .grid{display:grid;grid-template-columns:1fr;gap:12px;margin-top:12px}
    @media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}
    .card{border:1px solid #e6e6e6;border-radius:10px;padding:12px;background:#fff;box-shadow:0 2px 6px rgba(2,6,23,0.04)}
    button{padding:8px 12px;border-radius:8px;border:1px solid #d1d5db;background:#f8fafc}
    small{color:#6b7280}
    canvas{width:100%;height:260px;background:#000;border-radius:8px}
    video{width:100%;height:auto;border-radius:8px}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    input[type=file]{display:block}
    pre{white-space:pre-wrap;background:#0f172a;color:#fff;padding:8px;border-radius:6px;overflow:auto}
  </style>
</head>
<body>
  <header>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABlElEQVRYR+2WvW4TQRBFz0YIxSgkqkQq6Qq6Qq6Qq6Qq6Qq6Qq6Qq6Qp6A3mYg8Qq3g3RkH2b2m7sbK7M7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s7s78gWBUq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq1Wq0WgYp9sABX8w5wAAAABJRU5ErkJggg==" alt="logo" width="40" height="40" style="border-radius:8px">
    <div>
      <h1>Demo Web — Fitur Modern (All-in-One)</h1>
      <small>Salin & simpan sebagai <code>demo-web-fitur.html</code>. Jalankan via HTTPS / localhost untuk fitur PWA & Service Worker.</small>
    </div>
  </header>

  <section class="grid">
    <div class="card">
      <h3>1) Service Worker & Offline (Cache)</h3>
      <p><small>Daftar SW otomatis; jika berhasil akan cache halaman untuk offline.</small></p>
      <div class="row">
        <button id="btn-register-sw">Daftar Service Worker</button>
        <button id="btn-unregister-sw">Unregister SW</button>
        <button id="btn-show-notif">Tampilkan Notifikasi (via SW)</button>
        <button id="btn-install" disabled>Prompt Install PWA</button>
      </div>
      <p id="sw-status"><small>Status: belum terdaftar</small></p>
    </div>

    <div class="card">
      <h3>2) Notifikasi & Permission</h3>
      <p><small>Gunakan Permission Notification; notifikasi juga dapat dibuat langsung dari page.</small></p>
      <div class="row">
        <button id="btn-request-notif">Minta Permission</button>
        <button id="btn-page-notif">Tampilkan Notifikasi (Page)</button>
      </div>
      <p id="notif-status"><small>Permission: belum dicek</small></p>
    </div>

    <div class="card">
      <h3>3) Kamera & Ambil Foto</h3>
      <video id="camera" autoplay muted playsinline></video>
      <div style="margin-top:8px" class="row">
        <button id="btn-start-cam">Buka Kamera</button>
        <button id="btn-take-photo">Ambil Foto</button>
        <button id="btn-stop-cam">Tutup Kamera</button>
        <input id="photo-file" type="file" accept="image/*">
      </div>
      <canvas id="photo-canvas" style="display:none"></canvas>
      <div id="photo-result"></div>
    </div>

    <div class="card">
      <h3>4) Screen Capture</h3>
      <p><small>Menangkap layar (screen share) — perlu izin pengguna.</small></p>
      <div class="row">
        <button id="btn-capture-screen">Capture Layar</button>
        <button id="btn-stop-screen">Stop Capture</button>
      </div>
      <video id="screen-video" autoplay playsinline muted style="margin-top:8px"></video>
    </div>

    <div class="card">
      <h3>5) IndexedDB (Simpan data lokal)</h3>
      <p><small>Simpan & baca catatan ke DB browser (IndexedDB).</small></p>
      <div class="row">
        <input id="note-input" placeholder="Ketik catatan..." style="flex:1;padding:8px;border-radius:8px;border:1px solid #e5e7eb">
        <button id="btn-save-note">Simpan</button>
      </div>
      <div style="margin-top:8px">
        <button id="btn-load-notes">Muat Semua Catatan</button>
      </div>
      <pre id="notes-list">[]</pre>
    </div>

    <div class="card">
      <h3>6) File System Access (opsional)</h3>
      <p><small>Bisa simpan file langsung ke folder jika browser mendukung (Chrome).</small></p>
      <div class="row">
        <button id="btn-save-file">Simpan File (.txt)</button>
      </div>
    </div>

    <div class="card">
      <h3>7) WebGL Mini (canvas)</h3>
      <canvas id="glCanvas"></canvas>
      <p><small>Contoh animasi WebGL sederhana (segitiga berputar).</small></p>
    </div>

    <div class="card">
      <h3>8) WebSocket (Echo Test)</h3>
      <p><small>Hubungkan ke echo server publik untuk tes realtime.</small></p>
      <div class="row">
        <input id="ws-msg" placeholder="Pesan" style="flex:1;padding:8px;border-radius:8px;border:1px solid #e5e7eb">
        <button id="btn-ws-send">Kirim</button>
      </div>
      <div style="margin-top:8px">
        <button id="btn-ws-open">Buka WebSocket</button>
        <button id="btn-ws-close">Tutup WebSocket</button>
      </div>
      <pre id="ws-log">[log]</pre>
    </div>

  </section>

  <hr style="margin:18px 0">
  <footer style="text-align:center;color:#6b7280"><small>Catatan: beberapa fitur memerlukan HTTPS / localhost. Jika sesuatu tidak berfungsi, jalankan via server lokal (misal: `npx http-server` atau `python -m http.server`) atau deploy ke HTTPS.</small></footer>

<script>
// -------------------- SERVICE WORKER (sebagai blob, fallback jika browser blok) --------------------
const swCode = `
  const CACHE_NAME = 'demo-web-cache-v1';
  const FILES_TO_CACHE = ['/', '/index.html'];
  self.addEventListener('install', event => {
    self.skipWaiting();
    event.waitUntil(
      caches.open(CACHE_NAME).then(cache => cache.addAll(FILES_TO_CACHE)).catch(()=>{})
    );
  });
  self.addEventListener('activate', event => {
    event.waitUntil(self.clients.claim());
  });
  self.addEventListener('fetch', event => {
    event.respondWith(caches.match(event.request).then(resp=>resp||fetch(event.request)));
  });
  self.addEventListener('push', event => {
    const data = event.data ? event.data.json() : {title:'Push!', body:'Pesan push kosong'};
    event.waitUntil(self.registration.showNotification(data.title, {body:data.body}));
  });
  self.addEventListener('notificationclick', event => {
    event.notification.close();
    event.waitUntil(clients.openWindow('/'));
  });
`;

async function registerServiceWorker(){
  if(!('serviceWorker' in navigator)) return updateSWStatus('Service Worker tidak didukung');
  try{
    // buat blob URL untuk SW agar tetap single-file
    const blob = new Blob([swCode],{type:'application/javascript'});
    const swUrl = URL.createObjectURL(blob);
    const reg = await navigator.serviceWorker.register(swUrl);
    updateSWStatus('Terdaftar: scope=' + (reg.scope||'') );
    // listen for beforeinstallprompt
    window.addEventListener('beforeinstallprompt', e=>{
      e.preventDefault();
      window.deferredPrompt = e;
      document.getElementById('btn-install').disabled = false;
    });
  }catch(err){
    updateSWStatus('Gagal registrasi SW: '+err.message);
  }
}

async function unregisterServiceWorker(){
  const regs = await navigator.serviceWorker.getRegistrations();
  for(const r of regs) await r.unregister();
  updateSWStatus('Semua service worker di-unregister');
}

function updateSWStatus(text){document.getElementById('sw-status').innerHTML = '<small>Status: '+text+'</small>'}
// -----------------------------------------------------------------------------------------------

// Notifikasi
const notifStatus = document.getElementById('notif-status');
function updateNotifStatus(){notifStatus.textContent = 'Permission: ' + Notification.permission}
updateNotifStatus();

async function requestNotifPermission(){
  const p = await Notification.requestPermission();
  updateNotifStatus();
  return p;
}

async function showPageNotification(){
  if(Notification.permission !== 'granted'){alert('Permission belum diberikan'); return}
  const n = new Notification('Notifikasi dari Page', {body:'Halo — ini contoh notifikasi langsung dari script page.',tag:'demo-page'});
  n.onclick = ()=>window.focus();
}

async function showSWNotification(){
  if(!('serviceWorker' in navigator)) return alert('SW tidak didukung');
  if(Notification.permission !== 'granted') await requestNotifPermission();
  const reg = await navigator.serviceWorker.ready;
  try{
    await reg.showNotification('Notifikasi dari Service Worker', {body:'Ini dibuat via registration.showNotification()'});
  }catch(e){alert('Gagal tunjukkan notifikasi: '+e.message)}
}

// Kamera
let camStream=null;
const camera = document.getElementById('camera');
async function startCamera(){
  try{
    camStream = await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}, audio:false});
    camera.srcObject = camStream;
  }catch(e){alert('Gagal akses kamera: '+e.message)}
}
function stopCamera(){
  if(camStream){
    camStream.getTracks().forEach(t=>t.stop()); camStream=null; camera.srcObject=null;
  }
}
async function takePhoto(){
  if(!camStream) return alert('Kamera belum aktif');
  const canvas = document.getElementById('photo-canvas');
  const videoTrack = camStream.getVideoTracks()[0];
  const settings = videoTrack.getSettings();
  canvas.width = settings.width || camera.videoWidth;
  canvas.height = settings.height || camera.videoHeight;
  const ctx = canvas.getContext('2d');
  ctx.drawImage(camera,0,0,canvas.width,canvas.height);
  const dataUrl = canvas.toDataURL('image/png');
  document.getElementById('photo-result').innerHTML = '<img src="'+dataUrl+'" style="width:100%;border-radius:8px">';
}

// Screen capture
let screenStream=null; const screenVideo = document.getElementById('screen-video');
async function captureScreen(){
  try{
    screenStream = await navigator.mediaDevices.getDisplayMedia({video:true});
    screenVideo.srcObject = screenStream;
  }catch(e){alert('Gagal capture layar: '+e.message)}
}
function stopScreen(){ if(screenStream){screenStream.getTracks().forEach(t=>t.stop()); screenStream=null; screenVideo.srcObject=null} }

// IndexedDB sederhana
function openDB(){
  return new Promise((res,rej)=>{
    const req = indexedDB.open('demo-db',1);
    req.onupgradeneeded = e => { const db = e.target.result; if(!db.objectStoreNames.contains('notes')) db.createObjectStore('notes',{keyPath:'id',autoIncrement:true}); };
    req.onsuccess = e => res(e.target.result);
    req.onerror = e => rej(e.target.error);
  });
}
async function saveNote(text){ const db = await openDB(); const tx = db.transaction('notes','readwrite'); const store = tx.objectStore('notes'); await store.add({text,created:Date.now()}); return tx.complete; }
async function loadNotes(){ const db = await openDB(); const tx = db.transaction('notes','readonly'); const store = tx.objectStore('notes'); return new Promise((res,rej)=>{ const items=[]; store.openCursor().onsuccess = e => { const cur = e.target.result; if(cur){ items.push(cur.value); cur.continue(); } else res(items); } ); }); }

// File System Access (opsional)
async function saveFile(){
  const content = 'File dari Demo Web — ' + new Date().toISOString();
  if(window.showSaveFilePicker){
    const handle = await window.showSaveFilePicker({suggestedName:'demo.txt',types:[{description:'Text',accept:{'text/plain':['.txt']}}]});
    const writable = await handle.createWritable();
    await writable.write(content);
    await writable.close();
    alert('File tersimpan');
  }else{
    // fallback download
    const blob = new Blob([content],{type:'text/plain'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download='demo.txt'; a.click();
  }
}

// WebGL simple (segitiga berputar)
function startWebGL(){
  const canvas = document.getElementById('glCanvas');
  const gl = canvas.getContext('webgl');
  if(!gl) return canvas.parentNode.innerHTML += '<p><small>WebGL tidak didukung</small></p>';
  canvas.width = canvas.clientWidth; canvas.height = canvas.clientHeight;
  const vs = gl.createShader(gl.VERTEX_SHADER);
  gl.shaderSource(vs, 'attribute vec2 pos; uniform float ang; void main(){ float c=cos(ang); float s=sin(ang); gl_Position = vec4(c*pos.x - s*pos.y, s*pos.x + c*pos.y, 0.0, 1.0);}');
  gl.compileShader(vs);
  const fs = gl.createShader(gl.FRAGMENT_SHADER);
  gl.shaderSource(fs, 'precision mediump float; void main(){ gl_FragColor = vec4(0.2,0.7,0.9,1.0);}');
  gl.compileShader(fs);
  const prog = gl.createProgram(); gl.attachShader(prog,vs); gl.attachShader(prog,fs); gl.linkProgram(prog); gl.useProgram(prog);
  const buf = gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER,buf);
  const verts = new Float32Array([0,0.6, -0.5,-0.3, 0.5,-0.3]); gl.bufferData(gl.ARRAY_BUFFER,verts,gl.STATIC_DRAW);
  const posLoc = gl.getAttribLocation(prog,'pos'); gl.enableVertexAttribArray(posLoc); gl.vertexAttribPointer(posLoc,2,gl.FLOAT,false,0,0);
  const angLoc = gl.getUniformLocation(prog,'ang');
  let t=0; function draw(){ t+=0.02; gl.viewport(0,0,canvas.width,canvas.height); gl.clearColor(0,0,0,0); gl.clear(gl.COLOR_BUFFER_BIT); gl.uniform1f(angLoc,t); gl.drawArrays(gl.TRIANGLES,0,3); requestAnimationFrame(draw);} draw();
}

// WebSocket echo test
let ws=null; const wsLog = document.getElementById('ws-log');
function wsOpen(){ if(ws) return; const url = 'wss://echo.websocket.events'; // public echo
 ws = new WebSocket(url);
 ws.onopen = ()=> wsLog.textContent += '\n[OPEN]';
 ws.onmessage = e=> wsLog.textContent += '\n[RECV] '+e.data;
 ws.onclose = ()=>{ wsLog.textContent += '\n[CLOSED]'; ws=null; }
 ws.onerror = e=> wsLog.textContent += '\n[ERR]'; }
function wsClose(){ if(ws) ws.close(); }
function wsSend(){ const msg = document.getElementById('ws-msg').value || 'hello'; if(!ws) return alert('WS belum terbuka'); ws.send(msg); wsLog.textContent += '\n[SEND] '+msg; }

// Hook up UI
document.getElementById('btn-register-sw').onclick = ()=>registerServiceWorker();
document.getElementById('btn-unregister-sw').onclick = ()=>unregisterServiceWorker();
document.getElementById('btn-request-notif').onclick = ()=>requestNotifPermission().then(updateNotifStatus);
document.getElementById('btn-page-notif').onclick = ()=>showPageNotification();
document.getElementById('btn-show-notif').onclick = ()=>showSWNotification();
document.getElementById('btn-start-cam').onclick = ()=>startCamera();
document.getElementById('btn-stop-cam').onclick = ()=>stopCamera();
document.getElementById('btn-take-photo').onclick = ()=>takePhoto();

document.getElementById('btn-capture-screen').onclick = ()=>captureScreen();
document.getElementById('btn-stop-screen').onclick = ()=>stopScreen();

document.getElementById('btn-save-note').onclick = async ()=>{ const t=document.getElementById('note-input').value; if(!t) return alert('Isi dulu'); await saveNote(t); alert('Tersimpan'); document.getElementById('note-input').value=''; };
document.getElementById('btn-load-notes').onclick = async ()=>{ const notes = await loadNotes(); document.getElementById('notes-list').textContent = JSON.stringify(notes, null, 2); };
document.getElementById('btn-save-file').onclick = ()=>saveFile();

document.getElementById('btn-ws-open').onclick = ()=>wsOpen();
document.getElementById('btn-ws-close').onclick = ()=>wsClose();
document.getElementById('btn-ws-send').onclick = ()=>wsSend();

document.getElementById('photo-file').onchange = e =>{ const f = e.target.files[0]; if(!f) return; const img = document.createElement('img'); img.style.width='100%'; img.style.borderRadius='8px'; img.src = URL.createObjectURL(f); document.getElementById('photo-result').innerHTML=''; document.getElementById('photo-result').appendChild(img); };

document.getElementById('btn-install').onclick = async ()=>{
  const promptEvent = window.deferredPrompt; if(!promptEvent) return alert('Prompt install belum tersedia'); promptEvent.prompt(); const choice = await promptEvent.userChoice; if(choice.outcome==='accepted') alert('User install accepted'); window.deferredPrompt = null; document.getElementById('btn-install').disabled = true;
};

// auto init webgl
startWebGL();

// small auto-register attempt for convenience (silently fail if not allowed)
if(navigator.serviceWorker) registerServiceWorker().catch(()=>{});

</script>
</body>
</html>
